{% extends "base.html" %}
{% load static %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<div class="parent dboard-header">
  <div class="child dboard-title">
    <h1>Dashboard</h1>
  </div>
  <div class="indicator">
    {% if request.user.profile.spotify_connected %}
    <div class="child dboard-sync">
      <img src="/static/img/spotify_logo.png" class="logo">
      <div class="spotify-status connected"></div>
    </div>
    <a href="">Sync with Spotify</a>
    {% else %}
    <div class="child dboard-sync dboard-notconnected">
      <img src="/static/img/spotify_logo.png" class="logo">
      <div class="spotify-status notconnected"></div>
    </div>
    <a href="{% url "social:begin" "spotify" %}">Connect with Spotify</a>
    {% endif %}
  </div>
</div>

<br><br>
<table style="width: 100%">
  <colgroup>
    <col span="1" style="width: 50%;">
    <col span="1" style="width: 50%;">
  </colgroup>
  <tbody>
    <tr>
      <td>
        <h3 style="text-align: center"><u>Top 5 Artists</u></h3>
        <ol>
          {% for artist in profile.top_artist_list %}
          <li>{{ artist|safe }}</li>
          {% endfor %}
        </ol>
      </td>
      <td>
        <h3 style="text-align: center"><u>Top Genres</u></h3>
        <ul id="two-columns">
          {% for genre in profile.top_genre_list %}
          <li>{{ genre|safe }}</li>
          {% endfor %}
        </ul>
      </td>
    </tr>
    <tr>
      <td colspan=2>
          <table style="width: 100%">
            <colgroup>
              <col span="1" style="width: 15%;">
              <col span="1" style="width: 55%;">
              <col span="1" style="width: 30%;">
            </colgroup>
            <caption><h3 style="text-align: center"><u>Top 5 Tracks</u></h3></caption>
            <thead>
              <td>Rank</td>
              <td>Track Title</td>
              <td>Artists</td>
            </thead>
            <tbody>
              {% for track in profile.top_track_list %}
                <tr>
                  <td>{{ track.rank|safe }}.</td>
                  <td>{{ track.name|safe }}</td>
                  <td>
                    <ul style="padding-left: 20px;">
                      {% for artist in track.artists_repr %}
                      <li>{{ artist|safe }}</li>
                      {% endfor %}
                    </ul>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
          <br><br>
      </td>
    </tr>
    <tr>
      <td>
        <h3 style="text-align: center"><u>Current Track Analysis</u></h3>
        <canvas class="radar" id="current-track-radar"></canvas>
      </td>
      <td>
        <h3 style="text-align: center"><u>Top Tracks Analysis</u></h3>
        <canvas class="radar" id="top-tracks-radar"></canvas>
      </td>
    </tr>
    <tr>
      <td>
        <h3 style="text-align: center"><u>Recent Tracks Analysis</u></h3>
        <canvas class="radar" id="recent-tracks-radar"></canvas>
      </td>
      <td>
        <h3 style="text-align: center"><u>Liked Tracks Analysis</u></h3>
        <canvas class="radar" id="liked-tracks-radar"></canvas>
      </td>
    </tr>
    <tr>
      <td>
        <h3 style="text-align: center"><u>Playlist Tracks Analysis</u></h3>
        <canvas class="radar" id="playlist-tracks-radar"></canvas>
      </td>
      <td>
        <h3 style="text-align: center"><u>Saved Album Tracks Analysis</u></h3>
        <canvas class="radar" id="saved-ablum-tracks-radar"></canvas>
      </td>
    </tr>
    <tr>
      <td colspan=2>
        <br>
        <div class="distributionHeader"><u>Track Features Distribution</u></div>
        <div class="dropdown">
          <button class="dropbtn">All Tracks</button>
          <div class="dropdown-content">
            <a href="#">Last 5 Tracks</a>
            <a href="#">Last 25 Tracks</a>
            <a href="#">Last 50 Tracks</a>
            <a href="#">Liked Tracks</a>
            <a href="#">Recent Tracks</a>
            <a href="#">Top Tracks</a>
            <a href="#">Saved Album Tracks</a>
          </div>
        </div>
          <table style="width: 100%">
            <colgroup>
              <col span="1" style="width: 33%;">
              <col span="1" style="width: 34%;">
              <col span="1" style="width: 33%;">
            </colgroup>
            <tbody>
              <tr>
                <td><br><u>Danceability</u><canvas class="bar" id="danceability-bar"></canvas></td>
                <td><br><u>Energy</u><canvas class="bar" id="energy-bar"></canvas></td>
                <td><br><u>Key</u><canvas class="bar" id="key-bar"></canvas></td>
              </tr>
              <tr>
                <td><br><u>Loudness</u><canvas class="bar" id="loudness-bar"></canvas></td>
                <td><br><u>Mode</u><canvas class="bar" id="mode-bar"></canvas></td>
                <td><br><u>Speechiness</u><canvas class="bar" id="speechiness-bar"></canvas></td>
              </tr>
              <tr>
                <td><br><u>Acousticness</u><canvas class="bar" id="acousticness-bar"></canvas></td>
                <td><br><u>Instrumentalness</u><canvas class="bar" id="instrumentalness-bar"></canvas></td>
                <td><br><u>Liveness</u><canvas class="bar" id="liveness-bar"></canvas></td>
              </tr>
              <tr>
                <td><br><u>Valence</u><canvas class="bar" id="valence-bar"></canvas></td>
                <td><br><u>Tempo</u><canvas class="bar" id="tempo-bar"></canvas></td>
              </tr>
            </tbody>
          </table>
      </td>
    </tr>
  </tbody>
</table>
<br><br>
<a href="{% url "edit" %}">edit your profile</a> or <a
href="{% url "password_change" %}">change your password</a>.

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{{ radar_labels|json_script:"radar_labels" }}
{{ current_track|json_script:"current_track" }}
{{ profile_dict|json_script:"profile" }}
{{ histo_bins|json_script:"histo_bins" }}
{{ histo_data|json_script:"histo_data" }}
<script>
  const radar_labels = JSON.parse(document.getElementById("radar_labels").textContent);
  const current_track = JSON.parse(document.getElementById("current_track").textContent);
  const profile = JSON.parse(document.getElementById("profile").textContent);
  const histo_bins = JSON.parse(document.getElementById("histo_bins").textContent);
  const histo_data = JSON.parse(document.getElementById("histo_data").textContent);
</script>
<script src="{% static 'js/dashboard.js' %}"></script>
{% endblock %}