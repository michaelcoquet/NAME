{% extends "base.html" %}
{% load static %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<div class="parent dboard-header">
  <div class="child dboard-title">
    <h1>Dashboard</h1>
  </div>
  <div class="indicator">
    {% if request.user.profile.spotify_connected %}
    <div class="child dboard-sync">
      <img src="/static/img/spotify_logo.png" class="logo">
      <div class="spotify-status connected"></div>
    </div>
    <a href="">Sync with Spotify</a>
    {% else %}
    <div class="child dboard-sync dboard-notconnected">
      <img src="/static/img/spotify_logo.png" class="logo">
      <div class="spotify-status notconnected"></div>
    </div>
    <a href="{% url "social:begin" "spotify" %}">Connect with Spotify</a>
    {% endif %}
  </div>
</div>

<br><br>
<table style="width: 100%">
  <colgroup>
    <col span="1" style="width: 50%;">
    <col span="1" style="width: 50%;">
  </colgroup>
  <tbody>
    <tr>
      <td>
        <h3 style="text-align: center"><u>Top 5 Artists</u></h3>
        <ol>
          {% for artist in profile.top_artist_list %}
          <li>{{ artist|safe }}</li>
          {% endfor %}
        </ol>
      </td>
      <td>
        <h3 style="text-align: center"><u>Top Genres</u></h3>
        <ul id="two-columns">
          {% for genre in profile.top_genre_list %}
          <li>{{ genre|safe }}</li>
          {% endfor %}
        </ul>
      </td>
    </tr>
    <tr>
      <td colspan=2>
          <table style="width: 100%">
            <colgroup>
              <col span="1" style="width: 15%;">
              <col span="1" style="width: 55%;">
              <col span="1" style="width: 30%;">
            </colgroup>
            <caption><h3 style="text-align: center"><u>Top 5 Tracks</u></h3></caption>
            <thead>
              <td>Rank</td>
              <td>Track Title</td>
              <td>Artists</td>
            </thead>
            <tbody>
              {% for track in profile.top_track_list %}
                <tr>
                  <td>{{ track.rank|safe }}.</td>
                  <td>{{ track.name|safe }}</td>
                  <td>
                    <ul style="padding-left: 20px;">
                      {% for artist in track.artists_repr %}
                      <li>{{ artist|safe }}</li>
                      {% endfor %}
                    </ul>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
          <br><br>
      </td>
    </tr>
    <tr>
      <td>
        <h3 style="text-align: center"><u>Current Track Analysis</u></h3>
        {% if radar_charts.0 %}
          {{ radar_charts.0|safe }}
        {% else %}
          <p>No graph was provided.</p>
        {% endif %}
      </td>
      <td>
        <h3 style="text-align: center"><u>Top Tracks Analysis</u></h3>
        {% if radar_charts.6 %}
          {{ radar_charts.6|safe }}
        {% else %}
          <p>No graph was provided.</p>
        {% endif %}
      </td>
    </tr>
    <tr>
      <td>
        <h3 style="text-align: center"><u>Recent Tracks Analysis</u></h3>
        {% if radar_charts.3 %}
          {{ radar_charts.3|safe }}
        {% else %}
          <p>No graph was provided.</p>
        {% endif %}
      </td>
      <td>
        <h3 style="text-align: center"><u>Liked Tracks Analysis</u></h3>
        {% if radar_charts.2 %}
          {{ radar_charts.2|safe }}
        {% else %}
          <p>No graph was provided.</p>
        {% endif %}
      </td>
    </tr>
    <tr>
      <td>
        <h3 style="text-align: center"><u>Playlist Tracks Analysis</u></h3>
        {% if radar_charts.9 %}
          {{ radar_charts.9|safe }}
        {% else %}
          <p>No graph was provided.</p>
        {% endif %}
      </td>
      <td>
        <h3 style="text-align: center"><u>Saved Album Tracks Analysis</u></h3>
        {% if radar_charts.1 %}
          {{ radar_charts.1|safe }}
        {% else %}
          <p>No graph was provided.</p>
        {% endif %}
      </td>
    </tr>
    <tr>
      <td colspan=2>
        <br>
        <div class="distributionHeader"><u>Track Features Distribution</u></div>
        <div class="dropdown">
          <button class="dropbtn">All Tracks</button>
          <div class="dropdown-content">
            <a href="#">All Tracks </a>
            <a href="#">Liked Tracks</a>
            <a href="#">Recent Tracks</a>
            <a href="#">Top Tracks</a>
            <a href="#">Saved Album Tracks</a>
          </div>
        </div>
          <table style="width: 100%">
            <colgroup>
              <col span="1" style="width: 33%;">
              <col span="1" style="width: 34%;">
              <col span="1" style="width: 33%;">
            </colgroup>
            <tbody>
              <tr>
                <td><br><u>Danceability</u><br>
                  {% if histo_charts.1.0 %}
                    {{ histo_charts.1.0|safe }}
                  {% else %}
                    <p>No graph was provided.</p>
                  {% endif %}
                </td>
                <td><br><u>Energy</u><br>
                  {% if histo_charts.1.1 %}
                    {{ histo_charts.1.1|safe }}
                  {% else %}
                    <p>No graph was provided.</p>
                  {% endif %}
                </td>
                <td><br><u>Key</u><br>
                  {% if histo_charts.1.2 %}
                    {{ histo_charts.1.2|safe }}
                  {% else %}
                    <p>No graph was provided.</p>
                  {% endif %}
                </td>
              </tr>
              <tr>
                <td><br><u>Loudness</u><br>
                  {% if histo_charts.1.3 %}
                    {{ histo_charts.1.3|safe }}
                  {% else %}
                    <p>No graph was provided.</p>
                  {% endif %}
                </td>
                <td><br><u>Mode</u><br>
                  {% if histo_charts.1.4 %}
                    {{ histo_charts.1.4|safe }}
                  {% else %}
                    <p>No graph was provided.</p>
                  {% endif %}
                </td>
                <td><br><u>Speechiness</u><br>
                  {% if histo_charts.1.5 %}
                    {{ histo_charts.1.5|safe }}
                  {% else %}
                    <p>No graph was provided.</p>
                  {% endif %}
                </td>
              </tr>
              <tr>
                <td><br><u>Acousticness</u><br>
                  {% if histo_charts.1.6 %}
                    {{ histo_charts.1.6|safe }}
                  {% else %}
                    <p>No graph was provided.</p>
                  {% endif %}
                </td>
                <td><br><u>Instrumentalness</u><br>
                  {% if histo_charts.1.7 %}
                    {{ histo_charts.1.7|safe }}
                  {% else %}
                    <p>No graph was provided.</p>
                  {% endif %}
                </td>
                <td><br><u>Liveness</u><br>
                  {% if histo_charts.1.8 %}
                    {{ histo_charts.1.8|safe }}
                  {% else %}
                    <p>No graph was provided.</p>
                  {% endif %}
                </td>
              </tr>
              <tr>
                <td><br><u>Valence</u><br>
                  {% if histo_charts.1.9 %}
                    {{ histo_charts.1.9|safe }}
                  {% else %}
                    <p>No graph was provided.</p>
                  {% endif %}
                </td>
                <td><br><u>Tempo</u><br>
                  {% if histo_charts.1.10 %}
                    {{ histo_charts.1.10|safe }}
                  {% else %}
                    <p>No graph was provided.</p>
                  {% endif %}
                </td>
              </tr>
            </tbody>
          </table>
      </td>
    </tr>
  </tbody>
</table>
<br><br>
<a href="{% url "edit" %}">edit your profile</a> or <a
href="{% url "password_change" %}">change your password</a>.

<!-- {{ radar_labels|json_script:"radar_labels" }}
{{ current_track|json_script:"current_track" }} -->
{{ profile_dict|json_script:"profile" }}
<!-- {{ histo_bins|json_script:"histo_bins" }}
{{ histo_data|json_script:"histo_data" }} -->
<script>
  // const radar_labels = JSON.parse(document.getElementById("radar_labels").textContent);
  // const current_track = JSON.parse(document.getElementById("current_track").textContent);
  const profile = JSON.parse(document.getElementById("profile").textContent);
  // const histo_bins = JSON.parse(document.getElementById("histo_bins").textContent);
  // const histo_data = JSON.parse(document.getElementById("histo_data").textContent);
</script>
{% endblock %}